---
import Image from 'astro/components/Image.astro';
import { Calendar, Clock, ArrowRight, Bookmark } from 'lucide-astro';
import TEMPTODO from "../../assets/KickOff_03_2025.jpg"
import { Icon } from 'astro-icon/components';

const blogPosts = [
  {
    title: "Fakten vernetzen mit FactGrid",
    excerpt: "Ein Projekt zur modellhaften Erfassung historischer Daten in einer offenen Wissensdatenbank.",
    date: "2024-01-15",
    readTime: "8 min",
    category: "FactGrid",
    featured: true
  },
  {
    title: "Annotation historischer Regesten",
    excerpt: "Die manuelle Annotation von Regesten dient als Grundlage für das Validieren und Entwickeln automatischer Extraktionsverfahren.",
    date: "2024-01-10",
    readTime: "12 min",
    category: "Methodik",
    featured: false
  },
  {
    title: "Large Language Models in der Geschichtswissenschaft",
    excerpt: "Wie KI-Technologien die historische Forschung revolutionieren und neue Möglichkeiten der Quellenerschließung eröffnen.",
    date: "2024-01-05",
    readTime: "15 min",
    category: "KI & ML",
    featured: false
  },
  {
    title: "SPARQL-Abfragen für Historiker:innen",
    excerpt: "Ein praktischer Leitfaden für den Einstieg in semantische Datenbankabfragen für geschichtswissenschaftliche Forschung.",
    date: "2023-12-20",
    readTime: "10 min",
    category: "Tutorial",
    featured: false
  }
];

const allCategories = ["Alle", ...new Set(blogPosts.map(post => post.category))];
const categories = allCategories.map((cat, index) => ({
  name: cat,
  count: cat === "Alle" ? blogPosts.length : blogPosts.filter(p => p.category === cat).length,
  active: index === 0
}));

const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString('de-DE', { day: 'numeric', month: 'long', year: 'numeric' });
};

const [mainPost, ...otherPosts] = blogPosts;
---

<section class="fullscreen-section blog-section scrollbar-hide" id="blog-section">
  <div class="blog-container section-inner py-4">

    <!-- Header -->
    <div class="text-center mb-8 md:mb-10">
      <div class="inline-flex items-center gap-2 bg-blue-500/10 border border-blue-500/20 rounded-full px-4 py-2 mb-4 md:mb-6">
        <Bookmark size={14} class="text-blue-400" />
        <span class="text-blue-300 text-xs md:text-sm font-medium">Latest Insights</span>
      </div>

      <h2 class="section-title text-3xl sm:text-4xl md:text-6xl text-white mb-3 md:mb-4">
        Blog &
        <span class="bg-gradient-to-r from-blue-400 to-purple-600 bg-clip-text text-transparent">Updates</span>
      </h2>

      <p class="text-sm md:text-base text-slate-300 max-w-2xl mx-auto mb-5 md:mb-8 leading-relaxed">
        Aktuelle Entwicklungen, Forschungsergebnisse und Einblicke in die Welt der digitalen Geisteswissenschaften.
      </p>

      <div id="blog-filter" class="flex flex-wrap items-center justify-center gap-2">
        {categories.map((category) => (
          <button
            data-filter={category.name}
            class:list={[
              "px-3 py-1.5 rounded-full text-xs md:text-sm font-medium transition-all duration-300",
              category.active
                ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white'
                : 'bg-slate-800/50 text-slate-300 hover:bg-slate-700/50 hover:text-white border border-slate-700/50'
            ]}
          >
            {category.name} ({category.count})
          </button>
        ))}
      </div>
    </div>

    <!-- Blog grid -->
    <div id="blog-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-10">

      <!-- Featured post -->
      <article class="md:col-span-2 lg:col-span-2 grid-item group" data-category={mainPost.category}>
        <div class="landing-card overflow-hidden h-full flex flex-col rounded-2xl">
          <div class="relative h-48 md:h-56 overflow-hidden">
            <Image src={TEMPTODO} alt={mainPost.title} class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" />
            <div class="absolute top-3 left-3">
              <span class="px-3 py-1 bg-blue-500 text-white text-xs font-medium rounded-full">Featured</span>
            </div>
          </div>
          <div class="p-5 md:p-6 flex flex-col flex-grow">
            <span class="text-blue-400 text-xs font-semibold uppercase tracking-wider mb-2">{mainPost.category}</span>
            <div class="flex items-center gap-4 text-slate-400 text-xs mb-3">
              <div class="flex items-center gap-1"><Calendar size={12} /><span>{formatDate(mainPost.date)}</span></div>
              <div class="flex items-center gap-1"><Clock size={12} /><span>{mainPost.readTime} read</span></div>
            </div>
            <h3 class="text-lg md:text-xl font-bold text-white mb-3 group-hover:text-blue-400 transition-colors">{mainPost.title}</h3>
            <p class="text-slate-300 text-sm leading-relaxed mb-4 flex-grow">{mainPost.excerpt}</p>
            <a href="#" class="self-start flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors text-sm font-medium group/link">
              <span>Weiterlesen</span>
              <ArrowRight size={14} class="transition-transform duration-300 group-hover/link:translate-x-1" />
            </a>
          </div>
        </div>
      </article>

      <!-- Other posts -->
      {otherPosts.map((post) => (
        <article class="lg:col-span-1 grid-item group" data-category={post.category}>
          <div class="landing-card overflow-hidden h-full flex flex-col rounded-2xl">
            <div class="relative h-36 md:h-40 overflow-hidden">
              <Image src={TEMPTODO} alt={post.title} class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" />
            </div>
            <div class="p-4 md:p-5 flex flex-col flex-grow">
              <span class="text-purple-400 text-xs font-semibold uppercase tracking-wider mb-1.5">{post.category}</span>
              <div class="flex items-center gap-3 text-slate-400 text-xs mb-2">
                <div class="flex items-center gap-1"><Calendar size={11} /><span>{formatDate(post.date)}</span></div>
                <div class="flex items-center gap-1"><Clock size={11} /><span>{post.readTime}</span></div>
              </div>
              <h3 class="text-sm md:text-base font-bold text-white mb-2 group-hover:text-purple-400 transition-colors leading-snug">{post.title}</h3>
              <p class="text-slate-300 text-xs leading-relaxed mb-3 flex-grow">{post.excerpt}</p>
              <a href="#" class="self-start flex items-center gap-1.5 text-purple-400 hover:text-purple-300 transition-colors text-xs font-medium group/link">
                <span>Lesen</span>
                <ArrowRight size={12} class="transition-transform duration-300 group-hover/link:translate-x-1" />
              </a>
            </div>
          </div>
        </article>
      ))}
    </div>

  </div>
</section>

<script>
  import gsap from 'gsap';

  document.addEventListener('DOMContentLoaded', () => {
    gsap.fromTo("#blog-grid .grid-item",
      { opacity: 0, y: 16 },
      { opacity: 1, y: 0, duration: 0.6, stagger: 0.1, delay: 0.3 }
    );

    const filterButtons = document.querySelectorAll<HTMLButtonElement>('#blog-filter button');
    const blogArticles = document.querySelectorAll<HTMLElement>('#blog-grid .grid-item');

    const activeClasses = ['bg-gradient-to-r', 'from-blue-500', 'to-purple-600', 'text-white'];
    const inactiveClasses = ['bg-slate-800/50', 'text-slate-300', 'hover:bg-slate-700/50', 'hover:text-white', 'border', 'border-slate-700/50'];

    const applyFilter = (selectedFilter: string) => {
      filterButtons.forEach(btn => {
        btn.classList.remove(...activeClasses, ...inactiveClasses);
        if (btn.dataset.filter === selectedFilter) {
          btn.classList.add(...activeClasses);
        } else {
          btn.classList.add(...inactiveClasses);
        }
      });

      const visible: HTMLElement[] = [];
      blogArticles.forEach(article => {
        const isVisible = selectedFilter === 'Alle' || selectedFilter === article.dataset.category;
        article.style.display = isVisible ? '' : 'none';
        if (isVisible) visible.push(article);
      });
      gsap.fromTo(visible, { opacity: 0, y: 8 }, { opacity: 1, y: 0, duration: 0.4, stagger: 0.05 });
    };

    filterButtons.forEach(button => {
      button.addEventListener('click', () => {
        if (button.dataset.filter) applyFilter(button.dataset.filter);
      });
    });

    applyFilter('Alle');
  });
</script>

